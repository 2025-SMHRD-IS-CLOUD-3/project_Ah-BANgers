<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë©”ë‰´ ì„ íƒ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: #f0f0f0;
        }
        
        .kiosk-container {
            width: 1080px;
            height: 1920px;
            background: #F3FA8F;
            overflow: hidden;
            border-radius: 50px;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            display: flex;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }
        
        .top-section {
            width: 1080px;
            height: 300px;
            position: relative;
            background: #D5DF8A;
            box-shadow: 0px 4px 4px rgba(0, 0, 0, 0.25);
            overflow: hidden;
        }
        
        .top-menu-cards {
            padding-left: 5px;
            padding-right: 5px;
            padding-top: 10px;
            padding-bottom: 10px;
            left: 0px;
            top: 15px;
            position: absolute;
            box-shadow: 0px 4px 4px rgba(0, 0, 0, 0.25);
            justify-content: center;
            align-items: center;
            gap: 10px;
            display: flex;
        }
        
        .top-menu-card {
            width: 350px;
            height: 250px;
            background: #D9D9D9;
            box-shadow: 0px 4px 4px rgba(0, 0, 0, 0.25);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2rem;
            font-weight: bold;
            color: #333;
        }
        
        .top-menu-card:first-child {
            background: #FF0000;
            color: white;
        }
        
        .top-menu-card:hover {
            transform: scale(1.05);
            box-shadow: 0px 8px 16px rgba(0, 0, 0, 0.3);
        }
        
        .menu-grid {
            align-self: stretch;
            padding-left: 30px;
            padding-right: 30px;
            justify-content: space-between;
            align-items: center;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            flex: 1;
        }
        
        .menu-item {
            width: 320px;
            height: 450px;
            background: #D9D9D9;
            box-shadow: 0px 4px 15px 5px rgba(0, 0, 0, 0.50);
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            text-align: center;
        }
        
        .menu-item:hover {
            transform: scale(1.05);
            box-shadow: 0px 8px 25px rgba(0, 0, 0, 0.6);
            background: #C0C0C0;
        }
        
        .menu-item:active {
            transform: scale(0.98);
        }
        
        .menu-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }
        
        .menu-name {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
        }
        
        .menu-price {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 10px;
        }
        
        .menu-description {
            font-size: 1rem;
            color: #888;
            line-height: 1.4;
        }
        
        .bottom-section {
            position: relative;
            opacity: 0.50;
            background: #D5DF8A;
            overflow: hidden;
            justify-content: center;
            align-items: center;
            gap: 5px;
            display: flex;
            width: 100%;
            height: 297px;
        }
        
        .bottom-button {
            width: 535px;
            height: 297px;
            background: #D9D9D9;
            border: none;
            cursor: pointer;
            font-size: 48px;
            font-family: Inter;
            font-weight: 400;
            color: #333;
            transition: all 0.3s ease;
        }
        
        .bottom-button:hover {
            background: #C0C0C0;
            transform: scale(1.02);
        }
        
        .bottom-button:active {
            transform: scale(0.98);
        }
        
        .icon-left {
            width: 143px;
            height: 143px;
            left: 72px;
            top: 88px;
            position: absolute;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .icon-left-inner {
            width: 128.70px;
            height: 85.80px;
            left: 7.15px;
            top: 21.45px;
            position: absolute;
            background: black;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .icon-right {
            width: 152px;
            height: 152px;
            left: 894px;
            top: 76px;
            position: absolute;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .icon-right-inner {
            width: 128.05px;
            height: 106.48px;
            left: 9.59px;
            top: 20.38px;
            position: absolute;
            background: black;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .icon-left:hover, .icon-right:hover {
            transform: scale(1.1);
        }
        
        .icon-left:active, .icon-right:active {
            transform: scale(0.95);
        }
        
        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }
        
        .modal-overlay.show {
            display: flex;
        }
        
        .modal {
            background: white;
            border-radius: 30px;
            padding: 40px;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.3s ease;
            position: relative;
            height: 1500px;
            width: 1000px;
        }
        
        .modal-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #F3FA8F;
        }
        
        .modal-title {
            font-size: 2.5rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        
        .modal-subtitle {
            font-size: 1.2rem;
            color: #666;
        }
        
        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #ff6b6b;
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .modal-close:hover {
            background: #ff5252;
            transform: scale(1.1);
        }
        
        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .option-item {
            background: #f8f9fa;
            border: 3px solid #e9ecef;
            border-radius: 20px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }
        
        .option-item:hover {
            border-color: #F3FA8F;
            background: #fff;
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .option-item.selected {
            border-color: #4CAF50;
            background: #e8f5e8;
        }
        
        .option-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }
        
        .option-name {
            font-size: 1.3rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        
        .option-price {
            font-size: 1.1rem;
            color: #666;
        }
        
        .option-description {
            font-size: 0.9rem;
            color: #888;
            margin-top: 8px;
        }
        
        .quantity-selector {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 20px;
        }
        
        .quantity-btn {
            background: #F3FA8F;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .quantity-btn:hover {
            background: #e8f085;
            transform: scale(1.1);
        }
        
        .quantity-display {
            font-size: 2rem;
            font-weight: bold;
            color: #333;
            min-width: 80px;
            text-align: center;
        }
        
        .modal-actions {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 30px;
        }
        
        .modal-btn {
            padding: 20px 40px;
            border: none;
            border-radius: 25px;
            font-size: 1.3rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 150px;
        }
        
        .modal-btn.primary {
            background: #4CAF50;
            color: white;
        }
        
        .modal-btn.primary:hover {
            background: #45a049;
            transform: translateY(-2px);
        }
        
        .modal-btn.secondary {
            background: #f8f9fa;
            color: #333;
            border: 2px solid #e9ecef;
        }
        
        .modal-btn.secondary:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }
        
        /* ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        /* Ajax ê´€ë ¨ ìŠ¤íƒ€ì¼ */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        
        .loading-spinner {
            text-align: center;
            color: white;
        }
        
        .spinner {
            width: 80px;
            height: 80px;
            border: 8px solid #f3f3f3;
            border-top: 8px solid #F3FA8F;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            z-index: 3000;
            max-width: 400px;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            border-left: 5px solid #4CAF50;
        }
        
        .notification.warning {
            border-left: 5px solid #FF9800;
        }
        
        .notification.error {
            border-left: 5px solid #f44336;
        }
        
        .notification.info {
            border-left: 5px solid #2196F3;
        }
        
        .cart-counter {
            position: fixed;
            top: 20px;
            left: 20px;
            background: #f44336;
            color: white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            z-index: 1000;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }
        
        .cart-summary-popup {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
        }
        
        .cart-summary-popup h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }
        
        .cart-summary-popup p {
            margin: 10px 0;
            color: #666;
        }
        
        .recommendation {
            color: #4CAF50 !important;
            font-weight: bold;
            font-style: italic;
        }
        
        .view-cart-btn {
            background: #F3FA8F;
            border: none;
            border-radius: 25px;
            padding: 12px 25px;
            margin-top: 15px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s ease;
        }
        
        .view-cart-btn:hover {
            background: #e8f085;
            transform: translateY(-2px);
        }
        
        .cart-detail-modal {
            background: white;
            border-radius: 30px;
            padding: 40px;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .cart-detail-modal h2 {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
        }
        
        .cart-items {
            margin-bottom: 30px;
        }
        
        .cart-item {
            border: 2px solid #f0f0f0;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            background: #fafafa;
        }
        
        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .item-number {
            font-weight: bold;
            color: #666;
        }
        
        .item-status {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }
        
        .item-status.pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .item-status.preparing {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .item-status.ready {
            background: #d4edda;
            color: #155724;
        }
        
        .item-status.completed {
            background: #cce5ff;
            color: #004085;
        }
        
        .item-details {
            margin-bottom: 15px;
        }
        
        .sub-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .sub-item:last-child {
            border-bottom: none;
        }
        
        .item-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
            color: #666;
        }
        
        .cart-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .payment-btn, .clear-btn, .close-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .payment-btn {
            background: #4CAF50;
            color: white;
        }
        
        .payment-btn:hover {
            background: #45a049;
            transform: translateY(-2px);
        }
        
        .clear-btn {
            background: #f44336;
            color: white;
        }
        
        .clear-btn:hover {
            background: #da190b;
            transform: translateY(-2px);
        }
        
        .close-btn {
            background: #9e9e9e;
            color: white;
        }
        
        .close-btn:hover {
            background: #757575;
            transform: translateY(-2px);
        }
        
        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 1200px) {
            .kiosk-container {
                width: 90vw;
                height: 90vh;
                border-radius: 30px;
            }
            
            .menu-item {
                width: 25vw;
                height: 30vh;
            }
            
            .top-menu-card {
                width: 25vw;
                height: 20vh;
            }
            
            .bottom-button {
                width: 40vw;
                height: 25vh;
            }
            
            .modal {
                max-width: 90vw;
                margin: 20px;
            }
        }
        
        @media (max-width: 768px) {
            .kiosk-container {
                width: 95vw;
                height: 95vh;
                border-radius: 20px;
            }
            
            .menu-grid {
                flex-direction: column;
                gap: 15px;
            }
            
            .menu-item {
                width: 80vw;
                height: 20vh;
            }
            
            .top-menu-cards {
                flex-direction: column;
                gap: 15px;
            }
            
            .top-menu-card {
                width: 80vw;
                height: 15vh;
            }
            
            .bottom-section {
                flex-direction: column;
                height: auto;
                padding: 20px;
            }
            
            .bottom-button {
                width: 80vw;
                height: 15vh;
            }
            
            .modal {
                margin: 10px;
                padding: 20px;
            }
            
            .options-grid {
                grid-template-columns: 1fr;
            }
            
            .modal-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="kiosk-container">
        <!-- ìƒë‹¨ ì„¹ì…˜ - 3ê°œ ë©”ë‰´ ì¹´ë“œ -->
        <div class="top-section">
            <div class="top-menu-cards">
                <div class="top-menu-card" onclick="showModal('quick-menu')">ë¹ ë¥¸ ì£¼ë¬¸</div>
                <div class="top-menu-card" onclick="showModal('popular')">ì¸ê¸° ë©”ë‰´</div>
                <div class="top-menu-card" onclick="showModal('promotion')">í”„ë¡œëª¨ì…˜</div>
            </div>
        </div>
        
        <!-- ë©”ë‰´ ê·¸ë¦¬ë“œ -->
        <div class="menu-grid" id="menuGrid">
            <!-- ë©”ë‰´ ì•„ì´í…œë“¤ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
        </div>
        
        <!-- í•˜ë‹¨ ì„¹ì…˜ -->
        <div class="bottom-section">
            <button class="bottom-button" onclick="goBack()">ë’¤ë¡œê°€ê¸°</button>
            <button class="bottom-button" onclick="callStaff()">ì§ì› í˜¸ì¶œ</button>
            
            <!-- ì™¼ìª½ ì•„ì´ì½˜ -->
            <div class="icon-left" onclick="handleIconClick('ì™¼ìª½')">
                <div class="icon-left-inner">ğŸ”™</div>
            </div>
            
            <!-- ì˜¤ë¥¸ìª½ ì•„ì´ì½˜ -->
            <div class="icon-right" onclick="handleIconClick('ì˜¤ë¥¸ìª½')">
                <div class="icon-right-inner">â­ï¸</div>
            </div>
        </div>
    </div>

    <!-- ëª¨ë‹¬ ì˜¤ë²„ë ˆì´ -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal" id="modal">
            <button class="modal-close" onclick="closeModal()">Ã—</button>
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">ë©”ë‰´ ì„ íƒ</h2>
                <p class="modal-subtitle" id="modalSubtitle">ì›í•˜ì‹œëŠ” ì˜µì…˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”</p>
            </div>
            <div class="modal-content" id="modalContent">
                <!-- ì˜µì…˜ë“¤ì´ ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
            </div>
        </div>
    </div>

    <script>
        let currentCategory = '';
        let selectedOptions = [];
        let quantities = {};
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¹´í…Œê³ ë¦¬ íŒŒë¼ë¯¸í„° í™•ì¸ ë° ë©”ë‰´ ìƒì„±
        window.addEventListener('load', function() {
            const urlParams = new URLSearchParams(window.location.search);
            currentCategory = urlParams.get('category') || 'coffee';
            generateRandomMenus();
            console.log(`${currentCategory} ì¹´í…Œê³ ë¦¬ì˜ ë©”ë‰´ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”`);
            
            // Ajax ìƒíƒœ ì´ˆê¸°í™”
            initializeAjaxState();
        });
        
        // ëœë¤ ë©”ë‰´ ìƒì„±
        function generateRandomMenus() {
            const menuGrid = document.getElementById('menuGrid');
            const menus = getMenusByCategory(currentCategory);
            
            // 6ê°œì˜ ëœë¤ ë©”ë‰´ ì„ íƒ
            const randomMenus = getRandomMenus(menus, 6);
            
            menuGrid.innerHTML = randomMenus.map(menu => `
                <div class="menu-item" onclick="showModal('${menu.id}')">
                    <div class="menu-icon">${menu.icon}</div>
                    <div class="menu-name">${menu.name}</div>
                    <div class="menu-price">${menu.price.toLocaleString()}ì›</div>
                    <div class="menu-description">${menu.description}</div>
                </div>
            `).join('');
        }
        
        // ì¹´í…Œê³ ë¦¬ë³„ ë©”ë‰´ ë°ì´í„°
        function getMenusByCategory(category) {
            const menuData = {
                'coffee': [
                    { id: 'americano', name: 'ì•„ë©”ë¦¬ì¹´ë…¸', price: 4500, icon: 'â˜•', description: 'ê¹”ë”í•˜ê³  ì§„í•œ ì—ìŠ¤í”„ë ˆì†Œ' },
                    { id: 'latte', name: 'ì¹´í˜ë¼ë–¼', price: 5500, icon: 'ğŸ¥›', description: 'ë¶€ë“œëŸ¬ìš´ ìš°ìœ ì™€ ì—ìŠ¤í”„ë ˆì†Œ' },
                    { id: 'cappuccino', name: 'ì¹´í‘¸ì¹˜ë…¸', price: 5500, icon: 'â˜•', description: 'ì—ìŠ¤í”„ë ˆì†Œì™€ ìš°ìœ  ê±°í’ˆ' },
                    { id: 'mocha', name: 'ì¹´í˜ëª¨ì¹´', price: 6000, icon: 'ğŸ«', description: 'ì´ˆì½œë¦¿ê³¼ ì»¤í”¼ì˜ ì¡°í™”' },
                    { id: 'espresso', name: 'ì—ìŠ¤í”„ë ˆì†Œ', price: 4000, icon: 'â˜•', description: 'ì§„í•œ ì»¤í”¼ì˜ ë§›' },
                    { id: 'macchiato', name: 'ë§ˆí‚¤ì•„í† ', price: 5000, icon: 'ğŸ¥›', description: 'ì—ìŠ¤í”„ë ˆì†Œì— ìš°ìœ  ê±°í’ˆ' },
                    { id: 'flat-white', name: 'í”Œë«í™”ì´íŠ¸', price: 5800, icon: 'â˜•', description: 'ë¶€ë“œëŸ¬ìš´ ìš°ìœ ì™€ ì—ìŠ¤í”„ë ˆì†Œ' },
                    { id: 'cold-brew', name: 'ì½œë“œë¸Œë£¨', price: 6500, icon: 'ğŸ§Š', description: '24ì‹œê°„ ì €ì˜¨ ì¶”ì¶œ ì»¤í”¼' }
                ],
                'tea': [
                    { id: 'green-tea', name: 'ë…¹ì°¨', price: 4000, icon: 'ğŸ«–', description: 'ì‹ ì„ í•œ ë…¹ì°¨' },
                    { id: 'black-tea', name: 'í™ì°¨', price: 4000, icon: 'ğŸ«–', description: 'ì§„í•œ í™ì°¨' },
                    { id: 'herb-tea', name: 'í—ˆë¸Œí‹°', price: 4500, icon: 'ğŸŒ¿', description: 'ìì—°ìŠ¤ëŸ¬ìš´ í—ˆë¸Œí‹°' },
                    { id: 'chai-tea', name: 'ì°¨ì´í‹°', price: 5000, icon: 'â˜•', description: 'í–¥ì‹ ë£Œê°€ ë“¤ì–´ê°„ ì°¨ì´í‹°' },
                    { id: 'earl-grey', name: 'ì–¼ê·¸ë ˆì´', price: 4500, icon: 'ğŸ«–', description: 'ë² ë¥´ê°€ëª» í–¥ì˜ ì–¼ê·¸ë ˆì´' },
                    { id: 'jasmine-tea', name: 'ììŠ¤ë¯¼í‹°', price: 4500, icon: 'ğŸŒ¸', description: 'í–¥ê¸°ë¡œìš´ ììŠ¤ë¯¼í‹°' },
                    { id: 'oolong-tea', name: 'ìš°ë¡±ì°¨', price: 4800, icon: 'ğŸ«–', description: 'ì¤‘ê°„ ë°œíš¨ ì°¨' },
                    { id: 'rooibos-tea', name: 'ë£¨ì´ë³´ìŠ¤í‹°', price: 4200, icon: 'ğŸŒ¿', description: 'ë‚¨ì•„í”„ë¦¬ì¹´ í—ˆë¸Œí‹°' }
                ],
                'drink': [
                    { id: 'smoothie', name: 'ìŠ¤ë¬´ë””', price: 6000, icon: 'ğŸ¥¤', description: 'ì‹ ì„ í•œ ê³¼ì¼ ìŠ¤ë¬´ë””' },
                    { id: 'juice', name: 'ì£¼ìŠ¤', price: 4500, icon: 'ğŸ§ƒ', description: '100% ì²œì—° ì£¼ìŠ¤' },
                    { id: 'lemonade', name: 'ë ˆëª¬ì—ì´ë“œ', price: 4000, icon: 'ğŸ‹', description: 'ìƒí¼í•œ ë ˆëª¬ì—ì´ë“œ' },
                    { id: 'milkshake', name: 'ë°€í¬ì…°ì´í¬', price: 5500, icon: 'ğŸ¥›', description: 'ë¶€ë“œëŸ¬ìš´ ë°€í¬ì…°ì´í¬' },
                    { id: 'bubble-tea', name: 'ë²„ë¸”í‹°', price: 5000, icon: 'ğŸ§‹', description: 'ì«„ê¹ƒí•œ ë²„ë¸”í‹°' },
                    { id: 'hot-choco', name: 'í•«ì´ˆì½”', price: 4500, icon: 'â˜•', description: 'ë‹¬ì½¤í•œ í•«ì´ˆì½”' },
                    { id: 'ade', name: 'ì—ì´ë“œ', price: 4800, icon: 'ğŸ¹', description: 'ê³¼ì¼ ì—ì´ë“œ' },
                    { id: 'soda', name: 'ì†Œë‹¤', price: 3500, icon: 'ğŸ¥¤', description: 'íƒ„ì‚° ìŒë£Œ' }
                ],
                'quick-menu': [
                    { id: 'americano', name: 'ì•„ë©”ë¦¬ì¹´ë…¸', price: 4500, icon: 'â˜•', description: 'ê¹”ë”í•˜ê³  ì§„í•œ ì—ìŠ¤í”„ë ˆì†Œ' },
                    { id: 'latte', name: 'ì¹´í˜ë¼ë–¼', price: 5500, icon: 'ğŸ¥›', description: 'ë¶€ë“œëŸ¬ìš´ ìš°ìœ ì™€ ì—ìŠ¤í”„ë ˆì†Œ' },
                    { id: 'cappuccino', name: 'ì¹´í‘¸ì¹˜ë…¸', price: 5500, icon: 'â˜•', description: 'ì—ìŠ¤í”„ë ˆì†Œì™€ ìš°ìœ  ê±°í’ˆ' }
                ],
                'popular': [
                    { id: 'mocha', name: 'ì¹´í˜ëª¨ì¹´', price: 6000, icon: 'ğŸ«', description: 'ì´ˆì½œë¦¿ê³¼ ì»¤í”¼ì˜ ì¡°í™”' },
                    { id: 'tiramisu', name: 'í‹°ë¼ë¯¸ìˆ˜', price: 6500, icon: 'ğŸ°', description: 'ë¶€ë“œëŸ¬ìš´ ì»¤í”¼ í–¥ì˜ ë””ì €íŠ¸' },
                    { id: 'croissant', name: 'í¬ë£¨ì•„ìƒ', price: 3500, icon: 'ğŸ¥', description: 'ë°”ì‚­í•œ í”„ë‘ìŠ¤ì‹ ë¹µ' }
                ],
                'promotion': [
                    { id: 'combo1', name: 'ì»¤í”¼+ë””ì €íŠ¸ ì„¸íŠ¸', price: 8000, icon: 'ğŸ', description: 'ì»¤í”¼ì™€ ë””ì €íŠ¸ë¥¼ í•¨ê»˜ ì¦ê¸°ì„¸ìš”' },
                    { id: 'combo2', name: 'ì°¨+ê³¼ì ì„¸íŠ¸', price: 7000, icon: 'ğŸ', description: 'ì°¨ì™€ ê³¼ìë¥¼ í•¨ê»˜ ì¦ê¸°ì„¸ìš”' },
                    { id: 'happy', name: 'í•´í”¼ì•„ì›Œ í• ì¸', price: 0, icon: 'â°', description: 'ì˜¤í›„ 2-5ì‹œ 20% í• ì¸' }
                ]
            };
            
            return menuData[category] || menuData['coffee'];
        }
        
        // ëœë¤ ë©”ë‰´ ì„ íƒ
        function getRandomMenus(menus, count) {
            const shuffled = [...menus].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, count);
        }
        
        // ëª¨ë‹¬ í‘œì‹œ
        function showModal(type) {
            const modalOverlay = document.getElementById('modalOverlay');
            const modalTitle = document.getElementById('modalTitle');
            const modalSubtitle = document.getElementById('modalSubtitle');
            const modalContent = document.getElementById('modalContent');
            
            selectedOptions = [];
            quantities = {};
            
            modalOverlay.classList.add('show');
            
            // ëª¨ë‹¬ ë‚´ìš© ì„¤ì •
            switch(type) {
                case 'quick-menu':
                    modalTitle.textContent = 'âš¡ ë¹ ë¥¸ ì£¼ë¬¸';
                    modalSubtitle.textContent = 'ìì£¼ ì£¼ë¬¸í•˜ëŠ” ë©”ë‰´ë¥¼ ë¹ ë¥´ê²Œ ì„ íƒí•˜ì„¸ìš”';
                    modalContent.innerHTML = createQuickMenuOptions();
                    break;
                case 'popular':
                    modalTitle.textContent = 'ğŸ”¥ ì¸ê¸° ë©”ë‰´';
                    modalSubtitle.textContent = 'ê³ ê°ë“¤ì´ ê°€ì¥ ë§ì´ ì£¼ë¬¸í•˜ëŠ” ë©”ë‰´ì…ë‹ˆë‹¤';
                    modalContent.innerHTML = createPopularOptions();
                    break;
                case 'promotion':
                    modalTitle.textContent = 'ğŸ‰ í”„ë¡œëª¨ì…˜';
                    modalSubtitle.textContent = 'íŠ¹ë³„í•œ í• ì¸ê³¼ ì´ë²¤íŠ¸ë¥¼ í™•ì¸í•˜ì„¸ìš”';
                    modalContent.innerHTML = createPromotionOptions();
                    break;
                default:
                    // ê°œë³„ ë©”ë‰´ ì„ íƒ
                    const menu = findMenuById(type);
                    if (menu) {
                        modalTitle.textContent = `${menu.icon} ${menu.name}`;
                        modalSubtitle.textContent = 'ì˜µì…˜ì„ ì„ íƒí•˜ê³  ìˆ˜ëŸ‰ì„ ì§€ì •í•´ì£¼ì„¸ìš”';
                        modalContent.innerHTML = createMenuOptions(menu);
                    }
                    break;
            }
        }
        
        // ë©”ë‰´ IDë¡œ ë©”ë‰´ ì°¾ê¸°
        function findMenuById(id) {
            const allMenus = getMenusByCategory(currentCategory);
            return allMenus.find(menu => menu.id === id);
        }
        
        // ëª¨ë‹¬ ë‹«ê¸°
        function closeModal() {
            document.getElementById('modalOverlay').classList.remove('show');
            selectedOptions = [];
            quantities = {};
        }
        
        // ë¹ ë¥¸ ì£¼ë¬¸ ì˜µì…˜ ìƒì„±
        function createQuickMenuOptions() {
            const quickMenus = getMenusByCategory('quick-menu');
            return createOptionsGrid(quickMenus);
        }
        
        // ì¸ê¸° ë©”ë‰´ ì˜µì…˜ ìƒì„±
        function createPopularOptions() {
            const popularMenus = getMenusByCategory('popular');
            return createOptionsGrid(popularMenus);
        }
        
        // í”„ë¡œëª¨ì…˜ ì˜µì…˜ ìƒì„±
        function createPromotionOptions() {
            const promotions = getMenusByCategory('promotion');
            return createOptionsGrid(promotions);
        }
        
        // ê°œë³„ ë©”ë‰´ ì˜µì…˜ ìƒì„±
        function createMenuOptions(menu) {
            const options = [
                { id: 'hot', name: 'ëœ¨ê±°ìš´', price: 0, icon: 'ğŸ”¥', description: 'ëœ¨ê±°ìš´ ì˜¨ë„' },
                { id: 'cold', name: 'ì°¨ê°€ìš´', price: 0, icon: 'ğŸ§Š', description: 'ì°¨ê°€ìš´ ì˜¨ë„' },
                { id: 'sweet', name: 'ë‹¬ì½¤í•œ', price: 500, icon: 'ğŸ¯', description: 'ì‹œëŸ½ ì¶”ê°€' },
                { id: 'milk', name: 'ìš°ìœ  ì¶”ê°€', price: 300, icon: 'ğŸ¥›', description: 'ìš°ìœ  ì¶”ê°€' }
            ];
            
            return createOptionsGrid(options);
        }
        
        // ì˜µì…˜ ê·¸ë¦¬ë“œ ìƒì„±
        function createOptionsGrid(items) {
            return `
                <div class="options-grid">
                    ${items.map(item => `
                        <div class="option-item" onclick="toggleOption('${item.id}', '${item.name}', ${item.price})">
                            <div class="option-icon">${item.icon}</div>
                            <div class="option-name">${item.name}</div>
                            <div class="option-price">${item.price === 0 ? 'ë¬´ë£Œ' : item.price.toLocaleString() + 'ì›'}</div>
                            <div class="option-description">${item.description}</div>
                        </div>
                    `).join('')}
                </div>
                ${createQuantitySelector()}
                ${createModalActions()}
            `;
        }
        
        // ìˆ˜ëŸ‰ ì„ íƒê¸° ìƒì„±
        function createQuantitySelector() {
            return `
                <div class="quantity-selector">
                    <button class="quantity-btn" onclick="changeQuantity(-1)">-</button>
                    <div class="quantity-display" id="quantityDisplay">1</div>
                    <button class="quantity-btn" onclick="changeQuantity(1)">+</button>
                </div>
            `;
        }
        
        // ëª¨ë‹¬ ì•¡ì…˜ ë²„íŠ¼ ìƒì„±
        function createModalActions() {
            return `
                <div class="modal-actions">
                    <button class="modal-btn primary" onclick="addToCart()">ì¥ë°”êµ¬ë‹ˆì— ì¶”ê°€</button>
                    <button class="modal-btn secondary" onclick="closeModal()">ì·¨ì†Œ</button>
                </div>
            `;
        }
        
        // ì˜µì…˜ í† ê¸€
        function toggleOption(id, name, price) {
            const optionElement = event.currentTarget;
            const index = selectedOptions.findIndex(option => option.id === id);
            
            if (index > -1) {
                selectedOptions.splice(index, 1);
                optionElement.classList.remove('selected');
            } else {
                selectedOptions.push({ id, name, price });
                optionElement.classList.add('selected');
            }
            
            quantities = {};
            updateQuantityDisplay();
        }
        
        // ìˆ˜ëŸ‰ ë³€ê²½
        function changeQuantity(delta) {
            const quantityDisplay = document.getElementById('quantityDisplay');
            let currentQuantity = parseInt(quantityDisplay.textContent);
            let newQuantity = Math.max(1, currentQuantity + delta);
            quantityDisplay.textContent = newQuantity;
        }
        
        // ìˆ˜ëŸ‰ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateQuantityDisplay() {
            const quantityDisplay = document.getElementById('quantityDisplay');
            if (quantityDisplay) {
                quantityDisplay.textContent = '1';
            }
        }
        
        // ì¥ë°”êµ¬ë‹ˆì— ì¶”ê°€ (Ajax ë°©ì‹)
        function addToCart() {
            if (selectedOptions.length === 0) {
                showNotification('ì˜µì…˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }
            
            const quantity = parseInt(document.getElementById('quantityDisplay').textContent) || 1;
            const totalPrice = selectedOptions.reduce((sum, option) => sum + option.price, 0) * quantity;
            
            // ë¡œë”© í‘œì‹œ
            showLoading();
            
                    // Ajaxë¡œ ì¥ë°”êµ¬ë‹ˆì— ì¶”ê°€
        const cartData = {
            items: selectedOptions.map(option => ({
                id: option.id,
                name: option.name,
                price: option.price,
                quantity: quantity
            })),
            totalPrice: totalPrice,
            timestamp: new Date().toISOString()
        };
        
        // ì‹¤ì œ Ajax API í˜¸ì¶œ
        addToCartAjax(cartData);
        }
        
        // Ajax ì‘ë‹µ ì²˜ë¦¬
        function handleCartResponse(response) {
            hideLoading();
            
            if (response.success) {
                showNotification(`${response.message}\nì´ ê¸ˆì•¡: ${response.data.totalPrice.toLocaleString()}ì›`, 'success');
                
                // ì¥ë°”êµ¬ë‹ˆ ìƒíƒœ ì—…ë°ì´íŠ¸
                updateCartStatus(response.data);
                
                // ëª¨ë‹¬ ë‹«ê¸°
                closeModal();
                
                // ì‹¤ì‹œê°„ ì¥ë°”êµ¬ë‹ˆ ìš”ì•½ í‘œì‹œ
                showCartSummary();
            } else {
                showNotification('ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 'error');
            }
        }
        
        // ì¥ë°”êµ¬ë‹ˆ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateCartStatus(cartData) {
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì¥ë°”êµ¬ë‹ˆ ì •ë³´ ì €ì¥
            const existingCart = JSON.parse(localStorage.getItem('kioskCart') || '[]');
            existingCart.push(cartData);
            localStorage.setItem('kioskCart', JSON.stringify(existingCart));
            
            // ì¥ë°”êµ¬ë‹ˆ ì¹´ìš´í„° ì—…ë°ì´íŠ¸
            updateCartCounter(existingCart.length);
        }
        
        // ì¥ë°”êµ¬ë‹ˆ ì¹´ìš´í„° ì—…ë°ì´íŠ¸
        function updateCartCounter(count) {
            let counter = document.getElementById('cartCounter');
            if (!counter) {
                counter = document.createElement('div');
                counter.id = 'cartCounter';
                counter.className = 'cart-counter';
                document.body.appendChild(counter);
            }
            counter.textContent = count;
            counter.style.display = count > 0 ? 'block' : 'none';
        }
        
        // ì‹¤ì‹œê°„ ì¥ë°”êµ¬ë‹ˆ ìš”ì•½ í‘œì‹œ
        function showCartSummary() {
            const cart = JSON.parse(localStorage.getItem('kioskCart') || '[]');
            if (cart.length === 0) return;
            
            const totalItems = cart.reduce((sum, item) => sum + item.items.length, 0);
            const totalPrice = cart.reduce((sum, item) => sum + item.totalPrice, 0);
            
            // Ajaxë¡œ ì¥ë°”êµ¬ë‹ˆ ìš”ì•½ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            fetchCartSummary(totalItems, totalPrice);
        }
        
        // Ajaxë¡œ ì¥ë°”êµ¬ë‹ˆ ìš”ì•½ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        function fetchCartSummary(totalItems, totalPrice) {
            // ì‹¤ì œ Ajax API í˜¸ì¶œ
            fetchCartSummaryAjax(totalItems, totalPrice);
        }
        
        // ì¶”ì²œ ë©”ë‰´ ìƒì„±
        function getRecommendations(itemCount) {
            const recommendations = [];
            if (itemCount < 3) {
                recommendations.push('ì¶”ê°€ ë©”ë‰´ë¥¼ ì£¼ë¬¸í•˜ì‹œë©´ í• ì¸ í˜œíƒì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤!');
            }
            if (itemCount >= 5) {
                recommendations.push('ëŒ€ëŸ‰ ì£¼ë¬¸ ê°ì‚¬í•©ë‹ˆë‹¤! íŠ¹ë³„ í• ì¸ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
            return recommendations;
        }
        
        // ì¥ë°”êµ¬ë‹ˆ ìš”ì•½ í‘œì‹œ
        function displayCartSummary(summaryData) {
            const summaryHtml = `
                <div class="cart-summary-popup">
                    <h3>ğŸ›’ ì¥ë°”êµ¬ë‹ˆ ìš”ì•½</h3>
                    <p>ì´ ${summaryData.totalItems}ê°œ ë©”ë‰´</p>
                    <p>ì´ ê¸ˆì•¡: ${summaryData.totalPrice.toLocaleString()}ì›</p>
                    <p>ì˜ˆìƒ ì œì¡° ì‹œê°„: ${summaryData.estimatedTime}ë¶„</p>
                    ${summaryData.recommendations.map(rec => `<p class="recommendation">ğŸ’¡ ${rec}</p>`).join('')}
                    <button onclick="viewFullCart()" class="view-cart-btn">ì „ì²´ ì¥ë°”êµ¬ë‹ˆ ë³´ê¸°</button>
                </div>
            `;
            
            showNotification(summaryHtml, 'info', 5000);
        }
        
        // ì „ì²´ ì¥ë°”êµ¬ë‹ˆ ë³´ê¸°
        function viewFullCart() {
            const cart = JSON.parse(localStorage.getItem('kioskCart') || '[]');
            if (cart.length === 0) {
                showNotification('ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.', 'info');
                return;
            }
            
            // Ajaxë¡œ ìƒì„¸ ì¥ë°”êµ¬ë‹ˆ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            fetchDetailedCart();
        }
        
        // Ajaxë¡œ ìƒì„¸ ì¥ë°”êµ¬ë‹ˆ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        function fetchDetailedCart() {
            showLoading();
            
            // ì‹¤ì œ Ajax API í˜¸ì¶œ
            fetchDetailedCartAjax();
        }
        
        // ìƒì„¸ ì¥ë°”êµ¬ë‹ˆ í‘œì‹œ
        function displayDetailedCart(detailedCart) {
            const cartModal = `
                <div class="cart-detail-modal">
                    <h2>ğŸ›’ ìƒì„¸ ì¥ë°”êµ¬ë‹ˆ</h2>
                    <div class="cart-items">
                        ${detailedCart.map((item, index) => `
                            <div class="cart-item">
                                <div class="item-header">
                                    <span class="item-number">#${index + 1}</span>
                                    <span class="item-status ${item.status}">${getStatusText(item.status)}</span>
                                </div>
                                <div class="item-details">
                                    ${item.items.map(subItem => `
                                        <div class="sub-item">
                                            <span>${subItem.name}</span>
                                            <span>${subItem.quantity}ê°œ</span>
                                            <span>${subItem.price.toLocaleString()}ì›</span>
                                        </div>
                                    `).join('')}
                                </div>
                                <div class="item-footer">
                                    <span>ì˜ˆìƒ ì‹œê°„: ${item.estimatedTime}ë¶„</span>
                                    <span>ì†Œê³„: ${item.totalPrice.toLocaleString()}ì›</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="cart-actions">
                        <button onclick="proceedToPayment()" class="payment-btn">ê²°ì œ ì§„í–‰</button>
                        <button onclick="clearCart()" class="clear-btn">ì¥ë°”êµ¬ë‹ˆ ë¹„ìš°ê¸°</button>
                        <button onclick="closeCartModal()" class="close-btn">ë‹«ê¸°</button>
                    </div>
                </div>
            `;
            
            showModal('cart-detail', cartModal);
        }
        
        // ìƒíƒœ í…ìŠ¤íŠ¸ ë³€í™˜
        function getStatusText(status) {
            const statusMap = {
                'pending': 'ëŒ€ê¸°ì¤‘',
                'preparing': 'ì œì¡°ì¤‘',
                'ready': 'ì¤€ë¹„ì™„ë£Œ',
                'completed': 'ì™„ë£Œ'
            };
            return statusMap[status] || status;
        }
        
        // ê²°ì œ ì§„í–‰
        function proceedToPayment() {
            showNotification('ê²°ì œ ì‹œìŠ¤í…œìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤...', 'info');
            // ì‹¤ì œ ê²°ì œ í˜ì´ì§€ë¡œ ì´ë™í•˜ëŠ” ë¡œì§
        }
        
        // ì¥ë°”êµ¬ë‹ˆ ë¹„ìš°ê¸°
        function clearCart() {
            if (confirm('ì •ë§ë¡œ ì¥ë°”êµ¬ë‹ˆë¥¼ ë¹„ìš°ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem('kioskCart');
                updateCartCounter(0);
                showNotification('ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì›Œì¡ŒìŠµë‹ˆë‹¤.', 'success');
                closeCartModal();
            }
        }
        
        // ì¥ë°”êµ¬ë‹ˆ ëª¨ë‹¬ ë‹«ê¸°
        function closeCartModal() {
            const modal = document.querySelector('.cart-detail-modal');
            if (modal) {
                modal.remove();
            }
        }
        
        // ë’¤ë¡œ ê°€ê¸°
        function goBack() {
            window.location.href = 'menu-selection.html';
        }
        
        // ì§ì› í˜¸ì¶œ
        function callStaff() {
            alert('ì§ì›ì„ í˜¸ì¶œí–ˆìŠµë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”. ğŸš¨');
        }
        
        // ì•„ì´ì½˜ í´ë¦­ ì²˜ë¦¬
        function handleIconClick(iconName) {
            console.log(`${iconName} ì•„ì´ì½˜ì´ í´ë¦­ë˜ì—ˆìŠµë‹ˆë‹¤!`);
            if (iconName === 'ì™¼ìª½') {
                goBack();
            } else if (iconName === 'ì˜¤ë¥¸ìª½') {
                // ë‹¤ìŒ ë‹¨ê³„ë¡œ ì§„í–‰
                showModal('quick-menu');
            }
        }
        
        // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ ì§€ì›
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeModal();
            }
        });
        
        // í„°ì¹˜ ì´ë²¤íŠ¸ ê°œì„ 
        document.addEventListener('touchstart', function(event) {
            if (event.target.classList.contains('menu-item') || 
                event.target.classList.contains('top-menu-card') ||
                event.target.classList.contains('bottom-button') ||
                event.target.classList.contains('icon-left') ||
                event.target.classList.contains('icon-right')) {
                event.target.style.transform = 'scale(0.98)';
            }
        });
        
        document.addEventListener('touchend', function(event) {
            if (event.target.classList.contains('menu-item') || 
                event.target.classList.contains('top-menu-card') ||
                event.target.classList.contains('bottom-button') ||
                event.target.classList.contains('icon-left') ||
                event.target.classList.contains('icon-right')) {
                event.target.style.transform = 'scale(1)';
            }
        });
        
        // Ajax í†µì‹ ì„ ìœ„í•œ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
        function showLoading() {
            let loading = document.getElementById('loadingOverlay');
            if (!loading) {
                loading = document.createElement('div');
                loading.id = 'loadingOverlay';
                loading.className = 'loading-overlay';
                loading.innerHTML = `
                    <div class="loading-spinner">
                        <div class="spinner"></div>
                        <p>ì²˜ë¦¬ì¤‘ì…ë‹ˆë‹¤...</p>
                    </div>
                `;
                document.body.appendChild(loading);
            }
            loading.style.display = 'flex';
        }
        
        function hideLoading() {
            const loading = document.getElementById('loadingOverlay');
            if (loading) {
                loading.style.display = 'none';
            }
        }
        
        function showNotification(message, type = 'info', duration = 3000) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = message;
            
            document.body.appendChild(notification);
            
            // ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
            setTimeout(() => notification.classList.add('show'), 100);
            
            // ìë™ ì œê±°
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, duration);
        }
        
        // Ajax ì—ëŸ¬ ì²˜ë¦¬
        function handleAjaxError(error, context) {
            console.error(`Ajax Error in ${context}:`, error);
            showNotification(`ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`, 'error');
            hideLoading();
        }
        
        // Ajax íƒ€ì„ì•„ì›ƒ ì²˜ë¦¬
        function handleAjaxTimeout(context) {
            showNotification(`${context} ìš”ì²­ì´ ì‹œê°„ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.`, 'warning');
            hideLoading();
        }
        
        // Ajax ì¬ì‹œë„ ë¡œì§
        function retryAjaxRequest(requestFunction, maxRetries = 3) {
            let retryCount = 0;
            
            const attempt = () => {
                requestFunction().catch(error => {
                    retryCount++;
                    if (retryCount < maxRetries) {
                        showNotification(`ì¬ì‹œë„ ì¤‘... (${retryCount}/${maxRetries})`, 'warning');
                        setTimeout(attempt, 1000 * retryCount);
                    } else {
                        showNotification('ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤.', 'error');
                    }
                });
            };
            
            attempt();
        }
        
        // Ajax ìƒíƒœ ì´ˆê¸°í™”
        function initializeAjaxState() {
            // ì¥ë°”êµ¬ë‹ˆ ì¹´ìš´í„° ì´ˆê¸°í™”
            const cart = JSON.parse(localStorage.getItem('kioskCart') || '[]');
            updateCartCounter(cart.length);
            
            // ë„¤íŠ¸ì›Œí¬ ìƒíƒœ ëª¨ë‹ˆí„°ë§
            monitorNetworkStatus();
            
            // ì£¼ë¬¸ ìƒíƒœ í´ë§ ì‹œì‘
            startOrderStatusPolling();
        }
        
        // Ajax ìƒíƒœ ì´ˆê¸°í™”
        function initializeAjaxState() {
            // ì¥ë°”êµ¬ë‹ˆ ì¹´ìš´í„° ì´ˆê¸°í™”
            const cart = JSON.parse(localStorage.getItem('kioskCart') || '[]');
            updateCartCounter(cart.length);
            
            // ë„¤íŠ¸ì›Œí¬ ìƒíƒœ ëª¨ë‹ˆí„°ë§
            monitorNetworkStatus();
        }
        
        // ë„¤íŠ¸ì›Œí¬ ìƒíƒœ ëª¨ë‹ˆí„°ë§
        function monitorNetworkStatus() {
            if (!navigator.onLine) {
                showNotification('ì˜¤í”„ë¼ì¸ ëª¨ë“œì…ë‹ˆë‹¤. ì¼ë¶€ ê¸°ëŠ¥ì´ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.', 'warning');
            }
            
            window.addEventListener('online', () => {
                showNotification('ì˜¨ë¼ì¸ ìƒíƒœë¡œ ë³µêµ¬ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                // ì˜¤í”„ë¼ì¸ ì¤‘ ì €ì¥ëœ ë°ì´í„° ë™ê¸°í™”
                syncOfflineData();
            });
            
            window.addEventListener('offline', () => {
                showNotification('ì˜¤í”„ë¼ì¸ ìƒíƒœì…ë‹ˆë‹¤. ë°ì´í„°ëŠ” ë¡œì»¬ì— ì €ì¥ë©ë‹ˆë‹¤.', 'warning');
            });
        }
        
        // ì˜¤í”„ë¼ì¸ ë°ì´í„° ë™ê¸°í™”
        function syncOfflineData() {
            const offlineData = JSON.parse(localStorage.getItem('offlineData') || '[]');
            if (offlineData.length > 0) {
                showNotification('ì˜¤í”„ë¼ì¸ ë°ì´í„°ë¥¼ ë™ê¸°í™”í•˜ê³  ìˆìŠµë‹ˆë‹¤...', 'info');
                // ì‹¤ì œ ì„œë²„ ë™ê¸°í™” ë¡œì§
                setTimeout(() => {
                    localStorage.removeItem('offlineData');
                    showNotification('ë°ì´í„° ë™ê¸°í™”ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                }, 2000);
            }
        }
        
        // ===== ì‹¤ì œ Ajax API í˜¸ì¶œ í•¨ìˆ˜ë“¤ =====
        
        // ì¥ë°”êµ¬ë‹ˆì— ì¶”ê°€ Ajax
        function addToCartAjax(cartData) {
            // Java Spring Boot Mock API ì„œë²„ ì—”ë“œí¬ì¸íŠ¸
            const apiUrl = 'http://localhost:8080/api/cart/add';
            
            // Fetch APIë¥¼ ì‚¬ìš©í•œ Ajax ìš”ì²­
            fetch(apiUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer ' + getAuthToken()
                },
                body: JSON.stringify(cartData)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                handleCartResponse(data);
            })
            .catch(error => {
                console.error('Ajax Error:', error);
                
                // ì˜¤í”„ë¼ì¸ ëª¨ë“œì¼ ë•Œ ë¡œì»¬ ì €ì¥
                if (!navigator.onLine) {
                    const offlineData = JSON.parse(localStorage.getItem('offlineData') || '[]');
                    offlineData.push({
                        type: 'addToCart',
                        data: cartData,
                        timestamp: new Date().toISOString()
                    });
                    localStorage.setItem('offlineData', JSON.stringify(offlineData));
                    
                    // ë¡œì»¬ì—ì„œ ì„±ê³µ ì‘ë‹µ ì‹œë®¬ë ˆì´ì…˜
                    const localResponse = {
                        success: true,
                        message: 'ì¥ë°”êµ¬ë‹ˆì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤. (ì˜¤í”„ë¼ì¸ ëª¨ë“œ)',
                        cartId: 'CART_OFFLINE_' + Date.now(),
                        data: cartData
                    };
                    handleCartResponse(localResponse);
                } else {
                    // ì˜¨ë¼ì¸ ëª¨ë“œì—ì„œ ì—ëŸ¬ ë°œìƒ ì‹œ
                    handleAjaxError(error, 'ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€');
                }
            });
        }
        
        // ì¥ë°”êµ¬ë‹ˆ ìš”ì•½ ì •ë³´ ê°€ì ¸ì˜¤ê¸° Ajax
        function fetchCartSummaryAjax(totalItems, totalPrice) {
            const apiUrl = `http://localhost:8080/api/cart/summary?items=${totalItems}&total=${totalPrice}`;
            
            fetch(apiUrl, {
                method: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + getAuthToken()
                }
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                displayCartSummary(data);
            })
            .catch(error => {
                console.error('Ajax Error:', error);
                
                // ì˜¤í”„ë¼ì¸ ëª¨ë“œì¼ ë•Œ ë¡œì»¬ ë°ì´í„° ì‚¬ìš©
                if (!navigator.onLine) {
                    const localSummaryData = {
                        totalItems: totalItems,
                        totalPrice: totalPrice,
                        estimatedTime: Math.ceil(totalItems * 2),
                        recommendations: getRecommendations(totalItems)
                    };
                    displayCartSummary(localSummaryData);
                } else {
                    handleAjaxError(error, 'ì¥ë°”êµ¬ë‹ˆ ìš”ì•½ ì¡°íšŒ');
                }
            });
        }
        
        // ìƒì„¸ ì¥ë°”êµ¬ë‹ˆ ì •ë³´ ê°€ì ¸ì˜¤ê¸° Ajax
        function fetchDetailedCartAjax() {
            const apiUrl = 'http://localhost:8080/api/cart/detailed';
            
            fetch(apiUrl, {
                method: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + getAuthToken()
                }
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                displayDetailedCart(data);
                hideLoading();
            })
            .catch(error => {
                console.error('Ajax Error:', error);
                
                // ì˜¤í”„ë¼ì¸ ëª¨ë“œì¼ ë•Œ ë¡œì»¬ ë°ì´í„° ì‚¬ìš©
                if (!navigator.onLine) {
                    const cart = JSON.parse(localStorage.getItem('kioskCart') || '[]');
                    const localDetailedCart = cart.map(item => ({
                        ...item,
                        status: 'pending',
                        estimatedTime: Math.ceil(item.items.length * 2)
                    }));
                    displayDetailedCart(localDetailedCart);
                } else {
                    handleAjaxError(error, 'ìƒì„¸ ì¥ë°”êµ¬ë‹ˆ ì¡°íšŒ');
                }
                hideLoading();
            });
        }
        
        // ë©”ë‰´ ê²€ìƒ‰ Ajax (ì‹¤ì‹œê°„ ê²€ìƒ‰ ê¸°ëŠ¥)
        function searchMenuAjax(query) {
            const apiUrl = `http://localhost:8080/api/menu/search?q=${encodeURIComponent(query)}`;
            
            fetch(apiUrl, {
                method: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + getAuthToken()
                }
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                displaySearchResults(data);
            })
            .catch(error => {
                console.error('Ajax Error:', error);
                handleAjaxError(error, 'ë©”ë‰´ ê²€ìƒ‰');
            });
        }
        
        // ì‹¤ì‹œê°„ ì£¼ë¬¸ ìƒíƒœ ì—…ë°ì´íŠ¸ Ajax (WebSocket ëŒ€ì•ˆ)
        function startOrderStatusPolling() {
            const pollInterval = setInterval(() => {
                if (!navigator.onLine) {
                    clearInterval(pollInterval);
                    return;
                }
                
                updateOrderStatusAjax();
            }, 5000); // 5ì´ˆë§ˆë‹¤ í´ë§
        }
        
        // ì£¼ë¬¸ ìƒíƒœ ì—…ë°ì´íŠ¸ Ajax
        function updateOrderStatusAjax() {
            const apiUrl = 'http://localhost:8080/api/orders/status';
            
            fetch(apiUrl, {
                method: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + getAuthToken()
                }
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                updateOrderStatusDisplay(data);
            })
            .catch(error => {
                console.error('Ajax Error:', error);
                // í´ë§ ì¤‘ ì—ëŸ¬ëŠ” ì¡°ìš©íˆ ì²˜ë¦¬
            });
        }
        
        // ì¸ì¦ í† í° ê°€ì ¸ì˜¤ê¸° (ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ë³´ì•ˆ í† í° ì‚¬ìš©)
        function getAuthToken() {
            return localStorage.getItem('authToken') || 'demo-token';
        }
        
        // ê²€ìƒ‰ ê²°ê³¼ í‘œì‹œ
        function displaySearchResults(results) {
            // ê²€ìƒ‰ ê²°ê³¼ë¥¼ í™”ë©´ì— í‘œì‹œí•˜ëŠ” ë¡œì§
            console.log('Search results:', results);
        }
        
        // ì£¼ë¬¸ ìƒíƒœ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateOrderStatusDisplay(statusData) {
            // ì£¼ë¬¸ ìƒíƒœë¥¼ í™”ë©´ì— ì—…ë°ì´íŠ¸í•˜ëŠ” ë¡œì§
            console.log('Order status update:', statusData);
        }
        
        // Ajax ìš”ì²­ íƒ€ì„ì•„ì›ƒ ì„¤ì •
        function createTimeoutPromise(timeoutMs = 10000) {
            return new Promise((_, reject) => {
                setTimeout(() => {
                    reject(new Error('Request timeout'));
                }, timeoutMs);
            });
        }
        
        // Ajax ìš”ì²­ê³¼ íƒ€ì„ì•„ì›ƒì„ ê²°í•©
        function fetchWithTimeout(url, options, timeoutMs = 10000) {
            return Promise.race([
                fetch(url, options),
                createTimeoutPromise(timeoutMs)
            ]);
        }
    </script>
</body>
</html>
